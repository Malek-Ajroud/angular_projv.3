<div class="page-header">
    <h1 class="page-title">{{ isEditMode ? 'Modifier les informations' : 'Ajouter un enfant' }}</h1>
</div>

<div class="card" style="max-width: 600px; margin: 0 auto; cursor: default;">
    <form #childForm="ngForm" (ngSubmit)="submitForm(childForm)" novalidate>

        <!-- Prénom -->
        <div class="form-group">
            <label for="first_name">Prénom *</label>
            <input type="text" id="first_name" name="first_name" class="form-control" [(ngModel)]="child.first_name"
                #first_name="ngModel" [ngClass]="{ 'input-error': first_name.invalid && first_name.touched }" required
                minlength="2" maxlength="50">
            <div class="error-msg" *ngIf="first_name.touched && first_name.errors?.['required']">
                Le prénom est requis.
            </div>
            <div class="error-msg" *ngIf="first_name.errors?.['minlength']">
                Le prénom doit contenir au moins 2 caractères.
            </div>
        </div>

        <!-- Nom -->
        <div class="form-group">
            <label for="last_name">Nom</label>
            <input type="text" id="last_name" name="last_name" class="form-control" [(ngModel)]="child.last_name"
                minlength="2" maxlength="50">
        </div>

        <!-- Année scolaire -->
        <div class="form-group">
            <label for="school_year">Niveau scolaire</label>
            <input type="text" id="school_year" name="school_year" class="form-control" [(ngModel)]="child.school_year"
                placeholder="Ex: CP, 6ème, ...">
        </div>

        <!-- School Name -->
        <div class="form-group">
            <label for="school_name">Nom de l'établissement scolaire</label>
            <input type="text" id="school_name" name="school_name" class="form-control" [(ngModel)]="child.school_name">
        </div>

        <!-- Address -->
        <div class="form-group">
            <label for="address">Adresse</label>
            <textarea id="address" name="address" class="form-control" [(ngModel)]="child.address" rows="2"></textarea>
        </div>

        <!-- Date de Naissance -->
        <div class="form-group">
            <label for="birth_date">Date de naissance *</label>
            <input type="date" id="birth_date" name="birth_date" class="form-control" [(ngModel)]="child.birth_date"
                #birth_date="ngModel" (change)="validateDate()"
                [ngClass]="{ 'input-error': (birth_date.invalid && birth_date.touched) || futureDateError }" required>
            <div class="error-msg" *ngIf="birth_date.touched && birth_date.errors?.['required']">
                La date de naissance est requise.
            </div>
            <div class="error-msg" *ngIf="futureDateError">
                La date ne peut pas être dans le futur.
            </div>
        </div>

        <!-- Genre -->
        <div class="form-group">
            <label for="gender">Genre *</label>
            <select id="gender" name="gender" class="form-control" [(ngModel)]="child.gender" required>
                <option value="garçon">Garçon</option>
                <option value="fille">Fille</option>
                <option value="other">Autre</option>
            </select>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary" [disabled]="childForm.invalid || isSubmitting || futureDateError">
            <span *ngIf="!isSubmitting">{{ isEditMode ? 'Enregistrer' : 'Ajouter' }}</span>
            <span *ngIf="isSubmitting"><i class="fa fa-spinner fa-spin"></i> {{ isEditMode ? 'Enregistrement...' :
                'Ajout en cours...' }}</span>
        </button>

        <!-- Success Message -->
        <div *ngIf="successMessage" class="success-msg"
            style="margin-top: 15px; color: var(--success-green); font-weight: bold;">
            <i class="fa fa-check-circle"></i> {{ successMessage }}
        </div>

    </form>
</div>